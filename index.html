<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="jquery-1.4.2.js"></script>
 <script type="text/javascript">

    function appendCategory(id,name,parentId) {
       if($("#categories_" + parentId).length == 0) {
          $("#category_" + parentId).append("<ul id=\"categories_" + parentId + "\"></ul>");
       }
       $("#categories_" + parentId).append("<li id=\"category_" + id + "\"><a href=\"javascript:getItemIds(" + id + ")\">" + name + "</a></li>");
    }

    function loadCategoryTree(data) {
      $(data).find("category").each(function(){
         var name = $(this).children("name:first").text();
         var id = $(this).attr("id");
         var parentId = $(this).children("parent:first").text();
         appendCategory(id, name, parentId);
      });
    }

    function loadThumbnails(data) {

    }

    function loadItemId(data) {
       var categoryId = $(data).find("collection:first").attr("category-id");
       var ids = "";
       $(data).find("item-id").each(function() {
               ids = ids + "," + $(this).text();
             });

       $.get("http://shopping.mvm.com/cat3d_ctx/action/getItems?roc=shopping_vs&poc=F&itemIds=" + ids, loadThumbnails, "xml");
    }

    function getItemIds(categoryId) {
      $.get("http://shopping.mvm.com/cat3d_ctx/action/getCollection?categoryId=" + categoryId + "&poc=F&roc=shopping_vs", loadItemId, "xml")
    }

    $(document).ready(function(){
      $.get("http://shopping.mvm.com/cat3d_ctx/action/getCategoryTree?poc=F&roc=shopping_vs", loadCategoryTree, "xml");
    });
   </script>

</head>
<body>
   <div id="category_0">
   </div>
   <div id="items">
   </div>
</body>
</html>
